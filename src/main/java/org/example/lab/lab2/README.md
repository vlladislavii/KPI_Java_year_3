# Лабораторна робота №2: Stream API

#### Виконав: Кіселар Владислав
#### Група: ІС-32
#### Номер залікової книжки: 7

## Опис Завдання

Реалізувати роботу зі стрімами в Java для обробки даних доменної області з використанням Stream API, кастомних Gatherer та Collector.

### Визначення варіанту

- **C4 = 7 % 4 = 3**
- **Доменна область:** Хтонічні істоти (нечисть)
- **Обов'язкова інформація:** ім'я, вид істоти, дата першої згадки в (можливо окультній) літературі, сила атаки

### Поля для обробки

- **Поле A:** вид (тип істоти)
- **Параметр Б:** кількість років з моменту першої згадки в літературі
- **Поле В:** вид істоти (для групування)
- **Поле Г:** сила атаки

## Реалізовані завдання

### Завдання 3: Нескінченний генератор стріму

Клас `CreatureGenerator` створює нескінченний стрім об'єктів `ChthoniceCreature` з реалістичними параметрами:

- **Типи істот:** Вампіри, Демони, Дракони, Привиди, Перевертні, Відьми, Зомбі, Упирі, Банші, Тролі
- **Імена:** Унікальні імена для кожного типу істоти (Дракула, Смауг, Баба Яга, тощо)
- **Дати першої згадки:** Реалістичні дати залежно від типу:
  - Древні істоти (дракони, демони): 3000 до н.е. - 1900 н.е.
  - Середньовічні (вампіри, перевертні): 500 - 1950 н.е.
  - Сучасні (зомбі): 1800 - 2000 н.е.
- **Сила атаки:** Залежить від типу істоти

**Код:**
```java
public Stream<ChthoniceCreature> generateInfiniteStream() {
    return Stream.generate(this::generateCreature);
}
```

### Завдання 4: Кастомна операція для пропуску та збору

### SkipByFieldGatherer (Gatherer API)

**Використовує `Gatherer<ChthoniceCreature, State, ChthoniceCreature>`.**

**Особливості:**
- Реалізує інтерфейс `Gatherer` (Java 22+)
- Підтримує стан через внутрішній клас `State`
- Використовує `Integrator` для обробки кожного елемента
- `Combiner` для підтримки паралельних стрімів
- Пропускає перші N елементів заданого типу (Field A)
- Збирає рівно 500 елементів
- Автоматично зупиняє стрім після досягнення мети

**Використання:**
```java
List<ChthoniceCreature> creatures = generator.generateInfiniteStream()
    .gather(SkipByFieldGatherer.skipAndCollect(CreatureType.VAMPIRE, 10))
    .collect(Collectors.toList());
```

### Завдання 5: Фільтрація та групування

Фільтрація за діапазоном значень Параметра Б (кількість років з першої згадки) та групування за Полем В (тип істоти):

```java
Map<CreatureType, List<ChthoniceCreature>> groupedByType = creatures.stream()
    .filter(c -> {
        long years = c.getYearsSinceFirstMention();
        return years >= minYears && years <= maxYears;
    })
    .collect(Collectors.groupingBy(ChthoniceCreature::getType));
```

### Завдання 6: Кастомний Collector для статистики

Клас `CreatureStatisticsCollector` реалізує інтерфейс `Collector` для збору статистичних даних:

**Статистичні показники:**
- Мінімальне значення сили атаки
- Максимальне значення сили атаки
- Середнє значення сили атаки
- Стандартне відхилення

**Реалізація:**
```java
CreatureStatistics statistics = creatures.stream()
    .collect(CreatureStatisticsCollector.toStatistics());
```

**Формула стандартного відхилення:**
```
σ = √(Σ(xi - x_mean)² / (n-1))
```
де x_mean - середнє значення, n - кількість елементів.

### Завдання 7: Визначення викидів

Клас `OutlierAnalyzer` використовує метод міжквартильного розмаху (IQR) для виявлення викидів.

**Алгоритм:**
1. Сортування значень сили атаки
2. Обчислення квартилів:
   - Q1 (перший квартиль, 25-й перцентиль)
   - Q2 (медіана, 50-й перцентиль)
   - Q3 (третій квартиль, 75-й перцентиль)
3. Обчислення IQR: `IQR = Q3 - Q1`
4. Визначення меж:
   - Нижня межа: `Q1 - 1.5 × IQR`
   - Верхня межа: `Q3 + 1.5 × IQR`
5. Класифікація: значення поза межами вважаються викидами

**Результат:**
```json
{
  "data": 470,
  "outliers": 30
}
```

**Посилання:**
- [Міжквартильний розмах (Wikipedia)](https://uk.wikipedia.org/wiki/Міжквартільний_розмах)
- [Викиди в статистиці (Wikipedia)](https://uk.wikipedia.org/wiki/Викид_(статистика))

## Структура класів

```
lab2/
├── src/main/java/org/example/lab/lab2/
│   ├── ChthoniceCreature.java          # Доменна модель
│   ├── CreatureType.java               # Enum типів істот
│   ├── CreatureGenerator.java          # Генератор нескінченного стріму (Завдання 3)
│   ├── SkipByFieldGatherer.java        # Gatherer реалізація (Завдання 4)
│   ├── CreatureStatistics.java         # Клас статистичних даних
│   ├── CreatureStatisticsCollector.java # Кастомний Collector (Завдання 6)
│   ├── OutlierAnalyzer.java            # Аналізатор викидів (Завдання 7)
│   ├── Main.java                       # Демонстрація всіх завдань
│   └── README.md                       # Документація проекту
└── src/test/java/org/example/lab/lab2/
    ├── ChthoniceCreatureTest.java      # Тести доменної моделі
    ├── CreatureGeneratorTest.java      # Тести генератора
    └── OutlierAnalyzerTest.java        # Тести статистичного аналізу
```

## Запуск проекту

### Вимоги
- **Java Development Kit версії 22+** (для використання Gatherer API)
- Maven

### Компіляція
```bash
mvn clean compile
```

### Запуск основної програми
```bash
mvn --% clean compile exec:java -Dexec.mainClass="org.example.lab.lab2.Main"
```

### Запуск тестів
```bash
mvn test -Dtest="org.example.lab.lab2.*Test"
```

## Приклад виводу

```
=== Лабораторна робота №2: Stream API ===
Виконав: Кіселар Владислав, ІС-32
Варіант: C4 = 7 % 4 = 3 (Хтонічні істоти)

--- Завдання 3: Створення нескінченного генератора ---

--- Завдання 4: Генерація 500 об'єктів зі пропуском ---
Згенеровано 500 істот (пропущено перші 10 Вампір)
Приклади згенерованих істот:
ChthoniceCreature{name='Анкалагон', type=Дракон, firstMention=-1849-09-01 (3874 years ago), attackPower=75}
ChthoniceCreature{name='Відьма з Блер 35', type=Відьма, firstMention=1391-12-14 (633 years ago), attackPower=48}
ChthoniceCreature{name='Віла Плакальниця', type=Банші, firstMention=0877-08-02 (1148 years ago), attackPower=39}
ChthoniceCreature{name='Смауг', type=Дракон, firstMention=1882-08-28 (143 years ago), attackPower=62}
ChthoniceCreature{name='Привид Опери', type=Привид, firstMention=0903-05-18 (1122 years ago), attackPower=54}

--- Завдання 5: Фільтрація та групування ---
Фільтрація за діапазоном років: 100 - 2000
Групування за типом істоти:
  Перевертень: 54 істот
  Демон: 21 істот
  Привид: 28 істот
  Дракон: 27 істот
  Вампір: 40 істот
  Зомбі: 28 істот
  Троль: 47 істот
  Відьма: 54 істот
  Упир: 35 істот
  Банші: 54 істот

--- Завдання 6: Статистичний аналіз ---
Статистика по силі атаки:
- Кількість істот: 500
- Мінімальна сила атаки: 0
- Максимальна сила атаки: 100
- Середня сила атаки: 49.01
- Стандартне відхилення: 15.80

--- Завдання 7: Визначення викидів (IQR метод) ---
Аналіз викидів:
- Q1 (перший квартиль): 39.00
- Q2 (медіана): 47.00
- Q3 (третій квартиль): 57.00
- IQR (міжквартильний розмах): 18.00
- Нижня межа: 12.00
- Верхня межа: 84.00
- Категорії: {data=470, outliers=30}

Приклади викидів:
  Могильник (сила атаки: 100)
  Сірий Монах (сила атаки: 0)
  Плачуча Жінка (сила атаки: 9)
  Гуль з Катакомб (сила атаки: 6)
  Скорботна Тінь (сила атаки: 99)

Приклади звичайних значень:
  Анкалагон (сила атаки: 75)
  Відьма з Блер 35 (сила атаки: 48)
  Віла Плакальниця (сила атаки: 39)
  Смауг (сила атаки: 62)
  Привид Опери (сила атаки: 54)

=== Підсумок ===
Всього згенеровано істот: 500
Різних типів істот: 10
Звичайних значень: 470
Викидів: 30
Відсоток викидів: 6.00%
```

## Модульні тести

Проект містить комплексні JUnit 5 тести для всіх компонентів:

- `ChthoniceCreatureTest` - тести доменної моделі
- `CreatureGeneratorTest` - тести генератора (відтворюваність, різноманітність)
- `OutlierAnalyzerTest` - тести статистичного аналізу (квартилі, IQR, викиди)

Всі завдання виконані з використанням Stream API та відповідають вимогам Google Java Code Style.
